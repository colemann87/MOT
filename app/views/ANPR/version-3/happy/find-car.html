
{% extends "layout.html" %}

{% block pageTitle %}
GOV.UK Prototype Kit
{% endblock %}

{% block content %}


<div class="govuk-width-container">

  <div class="govuk-phase-banner">
    <p class="govuk-phase-banner__content">
      <!-- <strong class="govuk-tag govuk-phase-banner__content__tag">
      alpha
    </strong> -->
    <span class="govuk-phase-banner__text">
      This is a new service â€“ your <a class="govuk-link" href="">feedback</a> will help us to improve it.
    </span>
  </p>
</div>

<a href="#" class="govuk-back-link">Back</a>

<main class="govuk-main-wrapper">

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">




      <div id="hide-top-header">
        <span class="govuk-caption-l">MOT testing</span>
        <h1 class="govuk-heading-l">Find a vehicle</h1>

        <p class="govuk-body">Take a photo of the vehicle using a smartphone or tablet. </p>

        <p class="govuk-body">You can continue the test on your desktop after.</p>


      </div>
      

      <label id="open-camera-button" class="govuk-button">Open Camera</label>
      <label id="take-photo-button"  class="govuk-button">Take photo</label>
      <label id="close-camera-button" class="govuk-button">Stop Camera</label>

      <video id="video" width="320" height="240" autoplay></video>
      <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>



      <script>

        let camera_button = document.querySelector("#open-camera-button");
        let click_button = document.querySelector("#take-photo-button");
        let stop_button = document.querySelector("#close-camera-button");

        let video = document.querySelector("#video");
        let canvas = document.querySelector("#canvas");

        camera_button.addEventListener('click', async function() {
          let stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
          window.localStream = stream;
          video.srcObject = stream;
        });

        click_button.addEventListener('click', function() {
          canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
          let image_data_url = canvas.toDataURL('image/jpeg');

          // data url of the image
          loadFile(image_data_url);
        });

        stop_button.addEventListener('click', async function () {
          window.localStream.getTracks().forEach(track => track.stop())
        })


      </script>

      <!-- <p><img id="output" width="200" /></p> -->

      <script>
        var loadFile = function(image_data_url) {
          // let image_data_url = canvas.toDataURL('image/jpeg');

          var image = document.getElementById('output');
          image.src = image_data_url;

          var x = document.getElementById("myDIV");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("processing");
          if (x.style.display === "none") {
            x.style.display = "block";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("hide-top-header");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("open-camera-button");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("hide-help");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }
          if(document.getElementById("processing").style.display = "block") {
            setTimeout(function () {
                  // proceed
                  document.getElementById('button1').click()
              }, 1500)
             }
        };

      </script>

<!--
<script>
      function check() {
          (document.getElementById("processing").style.display = "block")
        return true;
      }

      if(check()) {
        setTimeout(function () {
              // proceed
              document.getElementById('button1').click()
          }, 1000)
         }
</script>
-->

      <div id="processing" style="display: none;">


    <!--      <h1 class="govuk-heading-l govuk-!-margin-bottom-9">Returning you to 'Request a basic DBS check'</h1>-->

          <div class="ccms-loader ccms-loader__fast govuk-!-margin-bottom-6"></div>

          <p style="text-align: center;">Processing image</p>

          <button id="button1" class="govuk-button govuk-!-margin-top-4 govuk-visually-hidden" data-module="govuk-button" onclick="renderPhoto()">Continue</button>


      </div>

      <script>
        var renderPhoto = function(event) {

          var x = document.getElementById("myDIV");
          if (x.style.display === "none") {
            x.style.display = "block";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("processing");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("hide-top-header");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("open-camera-button");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }

          var x = document.getElementById("hide-help");
          if (x.style.display === "block") {
            x.style.display = "none";
          } else {
            x.style.display = "none";
          }

        };

      </script>



      <div id="myDIV" style="display: none;">

        <span class="govuk-caption-l">MOT testing</span>
        <h1 class="govuk-heading-l">Photo accepted</h1>

        <h2 class="govuk-heading-m">Your photo</h2>

        <div class="image">
          <p><img id="output" style="width: 100%;max-width: 600px;height: auto;" /></p>
        </div>


        <form class="govuk-button-group" action="select-car">

          <button id="button2" class="govuk-button govuk-visually-hidden" data-module="govuk-button">Confirm photo</button>

          <button class="govuk-button govuk-!-margin-top-4" id="button--save" data-module="govuk-button">Confirm photo</button>

          <input type="file"  accept="image/*" name="image" id="file"  onchange="loadFile(event)" style="display: none;">

          <label for="file" class="govuk-button govuk-button--secondary" onchange="gotopage(this)">Take new photo</label>

        </form>


        <script type="text/javascript">
          submitSpinner()

          function buttonClicked(target) {
          target.setAttribute('disabled', 'disabled')
          target.className += ' button--save'
          setTimeout(function () {
            document.getElementById('button2').click()
          }, 2000)
          }

          function submitSpinner() {
          var selects = document.getElementById('button--save')
          selects.addEventListener('click', function (event) {
            event.preventDefault()
            if (selects.getAttribute('disabled') === 'disabled') {
              console.log('already clicked')
            } else {
              event.preventDefault()
              console.log(selects.getAttribute('disabled'))
              buttonClicked(selects)
            }
          })
          }
        </script>



      </div>

      <div id="hide-help">
        <p class="govuk-body">Make sure the photo:</p>
        <ul class="govuk-list govuk-list--bullet">
          <li>shows the registration number of the vehicle clearly</li>
          <li>shows the full front or back of the vehicle</li>
          <li>does not include any other vehicles </li>
          <li>is less than 4MB</li>
          <!-- <li>does not show any people</li> -->
        </ul>

        <!-- <details class="govuk-details" data-module="govuk-details">
        <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">
        Help taking a photo
      </span>
    </summary>
    <div class="govuk-details__text">
    Something, something
  </div>
</details> -->



<p><a href="manual-entry" class="govuk-link">Enter the registration number and vehicle identification number (VIN) manually </a></p>
</div>
<p><a href="../feedback.html" class="govuk-link">Report a problem</a></p>

<p><a href="start.html" class="govuk-link">Cancel and return home </a></p>

</div>
</div>

</main>
</div>






{% endblock %}
